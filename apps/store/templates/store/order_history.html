{% extends 'index.html' %}
{% load static %}

{% block content %}

<div class="order-history-container">
    <h2 class="mb-4 order-history-title">ðŸ“¦ Order History & Tracking</h2>

    {% if orders %}
    {% for order in orders %}
    <div class="card mb-4 shadow-sm order-card">
        <div class="card-header order-header">
            <div class="row align-items-center">
                <div class="col-md-6 col-12 mb-2 mb-md-0">
                    <strong class="order-id">Order #{{order.transaction_id|slice:":8"}}</strong>
                </div>
                <div class="col-md-6 col-12 text-md-end">
                    <small class="order-date">{{order.date_ordered|date:"M d, Y h:i A"}}</small>
                </div>
            </div>
        </div>
        <div class="card-body order-body">
            <div class="row">
                <div class="col-lg-8 col-12 mb-4 mb-lg-0">
                    <h6 class="order-items-title">Items:</h6>
                    <div class="order-items-list">
                        {% for item in order.orderitem_set.all %}
                            {% if item.product %}
                            <div class="d-flex align-items-center mb-2 order-item">
                                <span class="order-item-text">â€¢ {{item.product.name}} <strong>(x{{item.quantity}})</strong> - â‚¹{{item.get_total}}</span>
                            </div>
                            {% endif %}
                        {% endfor %}
                    </div>
                    <hr>
                    <h5 class="order-total">Total: â‚¹{{order.get_cart_total}}</h5>
                </div>
                <div class="col-lg-4 col-12">
                    <h6 class="order-status-title">Order Status:</h6>
                    <div class="progress order-progress" style="height: 30px;">
                        {% if order.status == 'pending' %}
                        <div class="progress-bar bg-warning" style="width: 25%">Pending</div>
                        {% elif order.status == 'processing' %}
                        <div class="progress-bar bg-info" style="width: 50%">Processing</div>
                        {% elif order.status == 'shipped' %}
                        <div class="progress-bar bg-primary" style="width: 75%">Shipped</div>
                        {% elif order.status == 'delivered' %}
                        <div class="progress-bar bg-success" style="width: 100%">Delivered</div>
                        {% else %}
                        <div class="progress-bar bg-secondary" style="width: 100%">{{order.status|title}}</div>
                        {% endif %}
                    </div>
                    <div class="mt-3 order-tracking">
                        <ul class="list-unstyled tracking-list">
                            <li class="tracking-step {% if order.status == 'pending' or order.status == 'processing' or order.status == 'shipped' or order.status == 'delivered' %}text-success{% else %}text-muted{% endif %}">âœ“ Order Placed</li>
                            <li class="tracking-step {% if order.status == 'processing' or order.status == 'shipped' or order.status == 'delivered' %}text-success{% else %}text-muted{% endif %}">{% if order.status == 'processing' or order.status == 'shipped' or order.status == 'delivered' %}âœ“{% else %}â—‹{% endif %} Processing</li>
                            <li class="tracking-step {% if order.status == 'shipped' or order.status == 'delivered' %}text-success{% else %}text-muted{% endif %}">{% if order.status == 'shipped' or order.status == 'delivered' %}âœ“{% else %}â—‹{% endif %} Shipped</li>
                            <li class="tracking-step {% if order.status == 'delivered' %}text-success{% else %}text-muted{% endif %}">{% if order.status == 'delivered' %}âœ“{% else %}â—‹{% endif %} Delivered</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endfor %}
    {% else %}
    <div class="alert alert-info text-center empty-orders">
        <h4>ðŸ“­ No Orders Yet</h4>
        <p>You haven't placed any orders yet.</p>
        <a href="{% url 'store' %}" class="btn btn-primary">Start Shopping</a>
    </div>
    {% endif %}
</div>

<style>
.order-history-container {
    min-height: 60vh;
    padding-bottom: 3rem;
}

.order-history-title {
    color: #EDEDED;
    font-size: 2rem;
    font-weight: 600;
}

.order-card {
    background: #1a1a1a;
    border: 1px solid rgba(123,97,255,0.3);
    border-radius: 12px;
    overflow: hidden;
}

.order-header {
    background: linear-gradient(135deg, #7B61FF 0%, #00C2FF 100%);
    color: white;
    padding: 1rem 1.5rem;
}

.order-id {
    font-size: 1.1rem;
}

.order-date {
    font-size: 0.9rem;
}

.order-body {
    padding: 1.5rem;
}

.order-items-title,
.order-status-title {
    color: #A196FF;
    font-size: 1rem;
    margin-bottom: 1rem;
}

.order-items-list {
    max-height: 300px;
    overflow-y: auto;
}

.order-item-text {
    color: #EDEDED;
    font-size: 0.95rem;
}

.order-total {
    color: #00C2FF;
    font-size: 1.5rem;
    font-weight: 700;
}

.order-progress {
    border-radius: 8px;
    overflow: hidden;
}

.tracking-list {
    margin: 0;
    padding: 0;
}

.tracking-step {
    padding: 0.5rem 0;
    font-size: 0.95rem;
}

.empty-orders {
    background: rgba(123,97,255,0.1);
    border-color: #7B61FF;
    color: #EDEDED;
    padding: 3rem 2rem;
    border-radius: 12px;
}

/* Desktop Responsive */
@media (min-width: 992px) {
    .order-history-container {
        max-width: 1200px;
        margin: 0 auto;
    }
}

/* Tablet Responsive */
@media (max-width: 991px) {
    .order-history-title {
        font-size: 1.75rem;
    }
    
    .order-header {
        padding: 1rem;
    }
    
    .order-body {
        padding: 1.25rem;
    }
}

/* Mobile Responsive */
@media (max-width: 768px) {
    .order-history-container {
        padding-bottom: 2rem;
    }
    
    .order-history-title {
        font-size: 1.5rem;
        margin-bottom: 1.5rem;
    }
    
    .order-header {
        padding: 0.75rem 1rem;
    }
    
    .order-id {
        font-size: 1rem;
    }
    
    .order-date {
        font-size: 0.8rem;
    }
    
    .order-body {
        padding: 1rem;
    }
    
    .order-items-title,
    .order-status-title {
        font-size: 0.95rem;
    }
    
    .order-item-text {
        font-size: 0.85rem;
    }
    
    .order-total {
        font-size: 1.25rem;
    }
    
    .tracking-step {
        font-size: 0.85rem;
        padding: 0.4rem 0;
    }
    
    .empty-orders {
        padding: 2rem 1rem;
    }
}

/* Small Mobile */
@media (max-width: 576px) {
    .order-history-title {
        font-size: 1.25rem;
    }
    
    .order-header {
        padding: 0.6rem 0.75rem;
    }
    
    .order-id {
        font-size: 0.9rem;
    }
    
    .order-date {
        font-size: 0.75rem;
    }
    
    .order-body {
        padding: 0.75rem;
    }
    
    .order-items-title,
    .order-status-title {
        font-size: 0.9rem;
    }
    
    .order-item-text {
        font-size: 0.8rem;
    }
    
    .order-total {
        font-size: 1.1rem;
    }
    
    .order-progress {
        height: 25px !important;
        font-size: 0.8rem;
    }
    
    .tracking-step {
        font-size: 0.8rem;
    }
}
</style>

{% endblock content %}
